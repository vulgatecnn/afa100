
> afa-office-miniprogram@1.0.0 test:coverage D:\vulgate\code\kiro\afa100\afa-office-system\miniprogram
> vitest --coverage --run

The CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.

[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mD:/vulgate/code/kiro/afa100/afa-office-system/miniprogram[39m
[2m      Coverage enabled with [22m[33mv8[39m

 [33mâ¯[39m tests/unit/services/notification.test.ts [2m ([22m[2m14 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 59[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/services/notification.test.ts[2m > [22mé€šçŸ¥æœåŠ¡æµ‹è¯•[2m > [22mé€šçŸ¥æ•°æ®éªŒè¯[2m > [22måº”è¯¥å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œé•¿æ–‡æœ¬[39m
[31m     â†’ expected 105 to be less than or equal to 104[39m
 [32mâœ“[39m tests/unit/pages/visitor-apply.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 40[2mms[22m[39m
 [33mâ¯[39m tests/unit/components/form-field.test.ts [2m ([22m[2m20 tests[22m [2m|[22m [31m11 failed[39m[2m)[22m[90m 64[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¾“å…¥äº‹ä»¶å¤„ç†[2m > [22måº”è¯¥å¤„ç†è¾“å…¥äº‹ä»¶å¹¶æ›´æ–°å€¼[39m
[31m     â†’ this.setData is not a function[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¾“å…¥äº‹ä»¶å¤„ç†[2m > [22måº”è¯¥å¤„ç†ç„¦ç‚¹äº‹ä»¶[39m
[31m     â†’ this.setData is not a function[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¡¨å•éªŒè¯[2m > [22måº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ[39m
[31m     â†’ Cannot read properties of undefined (reading 'required')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¡¨å•éªŒè¯[2m > [22måº”è¯¥éªŒè¯å­—æ®µé•¿åº¦[39m
[31m     â†’ Cannot read properties of undefined (reading 'value')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¡¨å•éªŒè¯[2m > [22måº”è¯¥éªŒè¯æ­£åˆ™è¡¨è¾¾å¼[39m
[31m     â†’ Cannot read properties of undefined (reading 'value')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¡¨å•éªŒè¯[2m > [22måº”è¯¥æ”¯æŒè‡ªå®šä¹‰éªŒè¯å‡½æ•°[39m
[31m     â†’ Cannot read properties of undefined (reading 'value')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mè¡¨å•éªŒè¯[2m > [22måº”è¯¥é€šè¿‡æ‰€æœ‰éªŒè¯è§„åˆ™[39m
[31m     â†’ Cannot read properties of undefined (reading 'value')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mæ ·å¼è®¡ç®—[2m > [22måº”è¯¥æ ¹æ®çŠ¶æ€è®¡ç®—è¾“å…¥æ¡†æ ·å¼[39m
[31m     â†’ Cannot read properties of undefined (reading 'focused')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mæ ·å¼è®¡ç®—[2m > [22måº”è¯¥è®¡ç®—æ ‡ç­¾æ ·å¼[39m
[31m     â†’ Cannot read properties of undefined (reading 'required')[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mä¸åŒå­—æ®µç±»å‹[2m > [22måº”è¯¥å¤„ç†æ–‡æœ¬åŸŸç±»å‹[39m
[31m     â†’ expected "spy" to be called with arguments: [ { characterCount: 7 } ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[2m    Object {[22m
[32m-     "characterCount": 7,[90m
[31m+     "characterCount": 6,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/components/form-field.test.ts[2m > [22mè¡¨å•å­—æ®µç»„ä»¶æµ‹è¯•[2m > [22mä¸åŒå­—æ®µç±»å‹[2m > [22måº”è¯¥å¤„ç†æ•°å­—ç±»å‹[39m
[31m     â†’ Cannot read properties of undefined (reading 'type')[39m
 [32mâœ“[39m tests/unit/utils/validation.test.ts [2m ([22m[2m51 tests[22m[2m)[22m[90m 53[2mms[22m[39m
 [33mâ¯[39m tests/unit/utils/storage.test.ts [2m ([22m[2m45 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 87[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/utils/storage.test.ts[2m > [22mæœ¬åœ°å­˜å‚¨å·¥å…·å‡½æ•°æµ‹è¯•[2m > [22mgetBatch æ–¹æ³•[2m > [22måº”è¯¥å¤„ç†è·å–å¼‚å¸¸[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'æ‰¹é‡è·å–æ•°æ®å¤±è´¥:', Any<Error> ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   "æ‰¹é‡è·å–æ•°æ®å¤±è´¥:",[90m
[32m-   Any<Error>,[90m
[31m+   "è·å–å­˜å‚¨æ•°æ®å¤±è´¥:",[90m
[31m+   [Error: è·å–å¤±è´¥],[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/utils/storage.test.ts[2m > [22mæœ¬åœ°å­˜å‚¨å·¥å…·å‡½æ•°æµ‹è¯•[2m > [22mgetUsageRate æ–¹æ³•[2m > [22måº”è¯¥å¤„ç†è·å–ä¿¡æ¯å¤±è´¥[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'è·å–å­˜å‚¨ä½¿ç”¨ç‡å¤±è´¥:', Any<Error> ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   "è·å–å­˜å‚¨ä½¿ç”¨ç‡å¤±è´¥:",[90m
[32m-   Any<Error>,[90m
[31m+   "è·å–å­˜å‚¨ä¿¡æ¯å¤±è´¥:",[90m
[31m+   [Error: è·å–ä¿¡æ¯å¤±è´¥],[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
 [32mâœ“[39m tests/unit/services/employee.test.ts [2m ([22m[2m26 tests[22m[2m)[22m[90m 196[2mms[22m[39m
 [32mâœ“[39m tests/unit/pages/visitor-passcode.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 51[2mms[22m[39m
 [33mâ¯[39m tests/e2e/complete-visitor-flow.test.ts [2m ([22m[2m16 tests[22m [2m|[22m [31m3 failed[39m[2m)[22m[90m 135[2mms[22m[39m
[31m   [33mâ¯[31m tests/e2e/complete-visitor-flow.test.ts[2m > [22mè®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•[2m > [22mæ•°æ®éªŒè¯æµ‹è¯•[2m > [22måº”è¯¥éªŒè¯è®¿å®¢ç”³è¯·æ•°æ®æ ¼å¼[39m
[31m     â†’ expected '2024-01-01T10:00:00.000Z' to be '2024-01-01T10:00:00Z' // Object.is equality[39m
[31m   [33mâ¯[31m tests/e2e/complete-visitor-flow.test.ts[2m > [22mè®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•[2m > [22mæ•°æ®éªŒè¯æµ‹è¯•[2m > [22måº”è¯¥éªŒè¯ç”³è¯·æ•°æ®å®Œæ•´æ€§[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [33mâ¯[31m tests/e2e/complete-visitor-flow.test.ts[2m > [22mè®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•[2m > [22mé€šè¡Œç å±•ç¤ºå®æ—¶æ€§æµ‹è¯•[2m > [22måº”è¯¥å®æ—¶æ›´æ–°é€šè¡Œç çŠ¶æ€[39m
[31m     â†’ expected 'active' to be 'expired' // Object.is equality[39m
 [32mâœ“[39m tests/unit/services/visitor.test.ts [2m ([22m[2m24 tests[22m[2m)[22m[90m 155[2mms[22m[39m
 [33mâ¯[39m tests/e2e/passcode-accuracy.test.ts [2m ([22m[2m10 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 177[2mms[22m[39m
[31m   [33mâ¯[31m tests/e2e/passcode-accuracy.test.ts[2m > [22mé€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯•[2m > [22mäºŒç»´ç ç”Ÿæˆå‡†ç¡®æ€§[2m > [22måº”è¯¥æ ¹æ®é€šè¡Œç å†…å®¹ç”Ÿæˆæ­£ç¡®çš„äºŒç»´ç [39m
[31m     â†’ expected "spy" to be called with arguments: [ +0, +0, 200, 200 ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [33mâ¯[31m tests/e2e/passcode-accuracy.test.ts[2m > [22mé€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯•[2m > [22mäºŒç»´ç ç”Ÿæˆå‡†ç¡®æ€§[2m > [22måº”è¯¥æ ¹æ®å±å¹•å°ºå¯¸è‡ªé€‚åº”äºŒç»´ç å¤§å°[39m
[31m     â†’ expected 177 to be 200 // Object.is equality[39m
[31m   [33mâ¯[31m tests/e2e/passcode-accuracy.test.ts[2m > [22mé€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯•[2m > [22mé€šè¡Œç çŠ¶æ€å®æ—¶æ›´æ–°[2m > [22måº”è¯¥å‡†ç¡®æ˜¾ç¤ºé€šè¡Œç çš„å®æ—¶çŠ¶æ€[39m
[31m     â†’ expected 'å·²è¿‡æœŸ' to be 'å‰©ä½™ 3 æ¬¡ä½¿ç”¨' // Object.is equality[39m
[31m   [33mâ¯[31m tests/e2e/passcode-accuracy.test.ts[2m > [22mé€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯•[2m > [22mé€šè¡Œç çŠ¶æ€å®æ—¶æ›´æ–°[2m > [22måº”è¯¥å‡†ç¡®æ˜¾ç¤ºé€šè¡Œç çš„è¿‡æœŸçŠ¶æ€[39m
[31m     â†’ expected true to be false // Object.is equality[39m
[31m   [33mâ¯[31m tests/e2e/passcode-accuracy.test.ts[2m > [22mé€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯•[2m > [22må‘˜å·¥é€šè¡Œç è‡ªåŠ¨åˆ·æ–°å‡†ç¡®æ€§[2m > [22måº”è¯¥æŒ‰ç…§è®¾å®šé¢‘ç‡å‡†ç¡®åˆ·æ–°å‘˜å·¥é€šè¡Œç [39m
[31m     â†’ Aborting after running 10000 timers, assuming an infinite loop![39m
 [33mâ¯[39m tests/unit/services/api.test.ts [2m ([22m[2m18 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 274[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/services/api.test.ts[2m > [22mAPIæœåŠ¡æµ‹è¯•[2m > [22må¹¶å‘è¯·æ±‚[2m > [22måº”è¯¥æ”¯æŒå¹¶å‘è¯·æ±‚[39m
[31m     â†’ expected 3 to be 1 // Object.is equality[39m
 [33mâ¯[39m tests/unit/components/status-badge.test.ts [2m ([22m[2m16 tests[22m [2m|[22m [31m3 failed[39m[2m)[22m[90m 68[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/components/status-badge.test.ts[2m > [22mçŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯•[2m > [22mçŠ¶æ€é…ç½®[2m > [22måº”è¯¥æ”¯æŒè‡ªå®šä¹‰çŠ¶æ€é…ç½®[39m
[31m     â†’ expected "spy" to be called with arguments: [ { statusConfig: { â€¦(2) } } ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[2m    Object {[22m
[2m      "statusConfig": Object {[22m
[2m        "pending": Object {[22m
[2m          "text": "å¾…å®¡æ‰¹",[22m
[2m          "type": "warning",[22m
[2m        },[22m
[31m+       "type": [Function Object],[90m
[31m+       "value": Object {[90m
[2m          "processing": Object {[22m
[2m            "text": "å¤„ç†ä¸­",[22m
[2m            "type": "primary",[22m
[31m+         },[90m
[2m        },[22m
[2m      },[22m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/components/status-badge.test.ts[2m > [22mçŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯•[2m > [22mæ¡ä»¶æ¸²æŸ“[2m > [22måº”è¯¥æ ¹æ®çŠ¶æ€æ§åˆ¶æ˜¾ç¤ºéšè—[39m
[31m     â†’ expected "spy" to be called with arguments: [ { visible: true } ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[2m    Object {[22m
[32m-     "visible": true,[90m
[31m+     "visible": "pending",[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [33mâ¯[31m tests/unit/components/status-badge.test.ts[2m > [22mçŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯•[2m > [22mæ¡ä»¶æ¸²æŸ“[2m > [22måº”è¯¥åœ¨çŠ¶æ€ä¸ºç©ºæ—¶éšè—ç»„ä»¶[39m
[31m     â†’ expected "spy" to be called with arguments: [ { visible: false } ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[2m    Object {[22m
[32m-     "visible": false,[90m
[31m+     "visible": "",[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
 [32mâœ“[39m tests/unit/pages/index.test.ts [2m ([22m[2m22 tests[22m[2m)[22m[90m 61[2mms[22m[39m
 [33mâ¯[39m tests/unit/components/qr-code.test.ts [2m ([22m[2m16 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 70[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/components/qr-code.test.ts[2m > [22mäºŒç»´ç ç»„ä»¶æµ‹è¯•[2m > [22må±æ€§å˜åŒ–ç›‘å¬[2m > [22måº”è¯¥ç›‘å¬codeå±æ€§å˜åŒ–å¹¶é‡æ–°ç”ŸæˆäºŒç»´ç [39m
[31m     â†’ [Function bound spy] is not a spy or a call to a spy![39m
[31m   [33mâ¯[31m tests/unit/components/qr-code.test.ts[2m > [22mäºŒç»´ç ç»„ä»¶æµ‹è¯•[2m > [22må±æ€§å˜åŒ–ç›‘å¬[2m > [22måº”è¯¥ç›‘å¬sizeå±æ€§å˜åŒ–å¹¶é‡æ–°ç”ŸæˆäºŒç»´ç [39m
[31m     â†’ [Function bound spy] is not a spy or a call to a spy![39m
 [32mâœ“[39m tests/e2e/passcode-display.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32mâœ“[39m tests/unit/pages/passcode-display.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 38[2mms[22m[39m
 [32mâœ“[39m tests/integration/passcode-display-flow.test.ts [2m ([22m[2m4 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32mâœ“[39m tests/examples/component-test-example.test.ts [2m ([22m[2m17 tests[22m[2m)[22m[90m 176[2mms[22m[39m
 [33mâ¯[39m tests/integration/employee-flow.test.ts [2m ([22m[2m10 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 76[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/employee-flow.test.ts[2m > [22mEmployee Flow Integration Tests[2m > [22mPasscode Management[2m > [22mshould handle passcode refresh failure[39m
[31m     â†’ expected [Function] to throw error including 'æœåŠ¡å™¨é”™è¯¯ï¼Œæ— æ³•åˆ·æ–°é€šè¡Œç ' but got 'HTTP 500: [object Object]'[39m
[31m   [33mâ¯[31m tests/integration/employee-flow.test.ts[2m > [22mEmployee Flow Integration Tests[2m > [22mData Validation[2m > [22mshould validate ID card format[39m
[31m     â†’ expected true to be false // Object.is equality[39m
 [32mâœ“[39m tests/unit/pages/login.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[33m 1646[2mms[22m[39m
 [33mâ¯[39m tests/unit/utils/date.test.ts [2m ([22m[2m42 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 68[2mms[22m[39m
[31m   [33mâ¯[31m tests/unit/utils/date.test.ts[2m > [22mæ—¥æœŸå·¥å…·å‡½æ•°æµ‹è¯•[2m > [22mè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†[2m > [22måº”è¯¥å¤„ç†ç©ºå€¼å’Œundefined[39m
[31m     â†’ expected [Function] to not throw an error but 'Error: æ— æ•ˆçš„æ—¥æœŸ' was thrown[39m
 [33mâ¯[39m tests/examples/page-test-example.test.ts [2m ([22m[2m15 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[33m 504[2mms[22m[39m
[31m   [33mâ¯[31m tests/examples/page-test-example.test.ts[2m > [22må°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹[2m > [22mè¡¨å•éªŒè¯æµ‹è¯•[2m > [22måº”è¯¥æ­£ç¡®éªŒè¯å¿…å¡«å­—æ®µ[39m
[31m     â†’ expected undefined to be truthy[39m
[31m   [33mâ¯[31m tests/examples/page-test-example.test.ts[2m > [22må°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹[2m > [22mè¡¨å•éªŒè¯æµ‹è¯•[2m > [22måº”è¯¥æ­£ç¡®éªŒè¯å¯†ç é•¿åº¦[39m
[31m     â†’ expected undefined to be truthy[39m
[31m   [33mâ¯[31m tests/examples/page-test-example.test.ts[2m > [22må°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹[2m > [22mç½‘ç»œè¯·æ±‚æµ‹è¯•[2m > [22måº”è¯¥æ­£ç¡®å¤„ç†ç½‘ç»œé”™è¯¯[39m
[31m     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   ObjectContaining {[90m
[32m-     "icon": "none",[90m
[32m-     "title": StringContaining "æœåŠ¡å™¨é”™è¯¯",[90m
[31m+   Object {[90m
[31m+     "icon": "success",[90m
[31m+     "title": "ç™»å½•æˆåŠŸ",[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [33mâ¯[31m tests/examples/page-test-example.test.ts[2m > [22må°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹[2m > [22mç½‘ç»œè¯·æ±‚æµ‹è¯•[2m > [22måº”è¯¥æ­£ç¡®å¤„ç†ç½‘ç»œè¶…æ—¶[39m
[31m     â†’ MiniprogramApiTestHelper.mockWxRequestTimeout is not a function[39m
[31m   [33mâ¯[31m tests/examples/page-test-example.test.ts[2m > [22må°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹[2m > [22mé¡µé¢çŠ¶æ€æµ‹è¯•[2m > [22måº”è¯¥æ­£ç¡®æ˜¾ç¤ºåŠ è½½çŠ¶æ€[39m
[31m     â†’ expected "spy" to be called with arguments: [ Array(1) ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
 [32mâœ“[39m tests/unit/pages/employee-apply.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [33mâ¯[39m tests/integration/visitor-flow.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[90m 34[2mms[22m[39m
[31m   [33mâ¯[31m tests/integration/visitor-flow.test.ts[2m > [22mVisitor Flow Integration Tests[2m > [22mComplete Visitor Application Flow[2m > [22mshould handle usage limit exceeded[39m
[31m     â†’ expected [Function] to throw error including 'é€šè¡Œç ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œæ— æ³•åˆ·æ–°' but got 'HTTP 400: [object Object]'[39m
[31m   [33mâ¯[31m tests/integration/visitor-flow.test.ts[2m > [22mVisitor Flow Integration Tests[2m > [22mError Handling[2m > [22mshould handle invalid application data[39m
[31m     â†’ expected [Function] to throw error including 'ç”³è¯·æ•°æ®æ— æ•ˆ' but got 'HTTP 400: [object Object]'[39m
 [32mâœ“[39m tests/e2e/employee-application-flow.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 26[2mms[22m[39m

â¯â¯â¯â¯â¯â¯ Failed Tests 38 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/complete-visitor-flow.test.ts > è®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯• > æ•°æ®éªŒè¯æµ‹è¯• > åº”è¯¥éªŒè¯è®¿å®¢ç”³è¯·æ•°æ®æ ¼å¼
AssertionError: expected '2024-01-01T10:00:00.000Z' to be '2024-01-01T10:00:00Z' // Object.is equality

- Expected
+ Received

- 2024-01-01T10:00:00Z
+ 2024-01-01T10:00:00.000Z

 â¯ tests/e2e/complete-visitor-flow.test.ts:439:36
    437|         const date = new Date(time);
    438|         expect(isNaN(date.getTime())).toBe(false);
    439|         expect(date.toISOString()).toBe(time);
       |                                    ^
    440|       });
    441| 
 â¯ tests/e2e/complete-visitor-flow.test.ts:436:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/38]â¯

 FAIL  tests/e2e/complete-visitor-flow.test.ts > è®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯• > æ•°æ®éªŒè¯æµ‹è¯• > åº”è¯¥éªŒè¯ç”³è¯·æ•°æ®å®Œæ•´æ€§
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/e2e/complete-visitor-flow.test.ts:478:33
    476|           return !value || (field === 'merchantId' && value <= 0) || (â€¦
    477|         });
    478|         expect(hasInvalidField).toBe(true);
       |                                 ^
    479|       });
    480|     });
 â¯ tests/e2e/complete-visitor-flow.test.ts:473:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/38]â¯

 FAIL  tests/e2e/complete-visitor-flow.test.ts > è®¿å®¢é¢„çº¦å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯• > é€šè¡Œç å±•ç¤ºå®æ—¶æ€§æµ‹è¯• > åº”è¯¥å®æ—¶æ›´æ–°é€šè¡Œç çŠ¶æ€
AssertionError: expected 'active' to be 'expired' // Object.is equality

- Expected
+ Received

- expired
+ active

 â¯ tests/e2e/complete-visitor-flow.test.ts:716:44
    714| 
    715|       await checkPasscodeStatus();
    716|       expect(pageData.passcodeInfo.status).toBe('expired');
       |                                            ^
    717|     });
    718| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/38]â¯

 FAIL  tests/e2e/passcode-accuracy.test.ts > é€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯• > äºŒç»´ç ç”Ÿæˆå‡†ç¡®æ€§ > åº”è¯¥æ ¹æ®é€šè¡Œç å†…å®¹ç”Ÿæˆæ­£ç¡®çš„äºŒç»´ç 
AssertionError: expected "spy" to be called with arguments: [ +0, +0, 200, 200 ]

Received: 



Number of calls: 0

 â¯ tests/e2e/passcode-accuracy.test.ts:131:33
    129|       
    130|       const mockCtx = mockWx.createCanvasContext();
    131|       expect(mockCtx.clearRect).toHaveBeenCalledWith(0, 0, 200, 200);
       |                                 ^
    132|       expect(mockCtx.setFillStyle).toHaveBeenCalledWith('#ffffff');
    133|       expect(mockCtx.fillRect).toHaveBeenCalledWith(0, 0, 200, 200);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/38]â¯

 FAIL  tests/e2e/passcode-accuracy.test.ts > é€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯• > äºŒç»´ç ç”Ÿæˆå‡†ç¡®æ€§ > åº”è¯¥æ ¹æ®å±å¹•å°ºå¯¸è‡ªé€‚åº”äºŒç»´ç å¤§å°
AssertionError: expected 177 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 177

 â¯ tests/e2e/passcode-accuracy.test.ts:169:24
    167| 
    168|         const qrSize = calculateQRSize(width);
    169|         expect(qrSize).toBe(expectedSize);
       |                        ^
    170|       });
    171|     });
 â¯ tests/e2e/passcode-accuracy.test.ts:147:19

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/38]â¯

 FAIL  tests/e2e/passcode-accuracy.test.ts > é€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯• > é€šè¡Œç çŠ¶æ€å®æ—¶æ›´æ–° > åº”è¯¥å‡†ç¡®æ˜¾ç¤ºé€šè¡Œç çš„å®æ—¶çŠ¶æ€
AssertionError: expected 'å·²è¿‡æœŸ' to be 'å‰©ä½™ 3 æ¬¡ä½¿ç”¨' // Object.is equality

- Expected
+ Received

- å‰©ä½™ 3 æ¬¡ä½¿ç”¨
+ å·²è¿‡æœŸ

 â¯ tests/e2e/passcode-accuracy.test.ts:273:44
    271|       // åˆå§‹åŠ è½½
    272|       await passcodePage.loadPasscodeInfo();
    273|       expect(passcodePage.data.statusText).toBe('å‰©ä½™ 3 æ¬¡ä½¿ç”¨');
       |                                            ^
    274|       expect(passcodePage.data.isExpired).toBe(false);
    275| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/38]â¯

 FAIL  tests/e2e/passcode-accuracy.test.ts > é€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯• > é€šè¡Œç çŠ¶æ€å®æ—¶æ›´æ–° > åº”è¯¥å‡†ç¡®æ˜¾ç¤ºé€šè¡Œç çš„è¿‡æœŸçŠ¶æ€
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ tests/e2e/passcode-accuracy.test.ts:386:34
    384| 
    385|         const result = checkPasscodeStatus(passcode);
    386|         expect(result.isExpired).toBe(expected.isExpired);
       |                                  ^
    387|         expect(result.statusText).toBe(expected.statusText);
    388|       });
 â¯ tests/e2e/passcode-accuracy.test.ts:366:17

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/38]â¯

 FAIL  tests/e2e/passcode-accuracy.test.ts > é€šè¡Œç å±•ç¤ºå‡†ç¡®æ€§æµ‹è¯• > å‘˜å·¥é€šè¡Œç è‡ªåŠ¨åˆ·æ–°å‡†ç¡®æ€§ > åº”è¯¥æŒ‰ç…§è®¾å®šé¢‘ç‡å‡†ç¡®åˆ·æ–°å‘˜å·¥é€šè¡Œç 
Error: Aborting after running 10000 timers, assuming an infinite loop!
â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/38]â¯

 FAIL  tests/examples/page-test-example.test.ts > å°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹ > è¡¨å•éªŒè¯æµ‹è¯• > åº”è¯¥æ­£ç¡®éªŒè¯å¿…å¡«å­—æ®µ
AssertionError: expected undefined to be truthy

- Expected: 
undefined

+ Received: 
false

 â¯ Function.expectFormValidation tests/utils/page-test-helper.ts:358:47
    356|       expect(pageContext.data[validationKey]).toBeFalsy()
    357|     } else {
    358|       expect(pageContext.data[validationKey]).toBeTruthy()
       |                                               ^
    359|       
    360|       if (errorMessage) {
 â¯ tests/examples/page-test-example.test.ts:214:14
 â¯ tests/utils/page-test-helper.ts:460:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/38]â¯

 FAIL  tests/examples/page-test-example.test.ts > å°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹ > è¡¨å•éªŒè¯æµ‹è¯• > åº”è¯¥æ­£ç¡®éªŒè¯å¯†ç é•¿åº¦
AssertionError: expected undefined to be truthy

- Expected: 
undefined

+ Received: 
false

 â¯ Function.expectFormValidation tests/utils/page-test-helper.ts:358:47
    356|       expect(pageContext.data[validationKey]).toBeFalsy()
    357|     } else {
    358|       expect(pageContext.data[validationKey]).toBeTruthy()
       |                                               ^
    359|       
    360|       if (errorMessage) {
 â¯ tests/examples/page-test-example.test.ts:229:14
 â¯ tests/utils/page-test-helper.ts:460:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/38]â¯

 FAIL  tests/examples/page-test-example.test.ts > å°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹ > ç½‘ç»œè¯·æ±‚æµ‹è¯• > åº”è¯¥æ­£ç¡®å¤„ç†ç½‘ç»œé”™è¯¯
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 

  1st spy call:

  Array [
-   ObjectContaining {
-     "icon": "none",
-     "title": StringContaining "æœåŠ¡å™¨é”™è¯¯",
+   Object {
+     "icon": "success",
+     "title": "ç™»å½•æˆåŠŸ",
    },
  ]


Number of calls: 1

 â¯ Function.expectPageError tests/utils/page-test-helper.ts:259:28
    257|   ): void {
    258|     if (errorType === 'toast') {
    259|       expect(wx.showToast).toHaveBeenCalledWith(
       |                            ^
    260|         expect.objectContaining({
    261|           title: expect.stringContaining(errorMessage),
 â¯ tests/examples/page-test-example.test.ts:271:14
 â¯ tests/utils/page-test-helper.ts:460:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/38]â¯

 FAIL  tests/examples/page-test-example.test.ts > å°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹ > ç½‘ç»œè¯·æ±‚æµ‹è¯• > åº”è¯¥æ­£ç¡®å¤„ç†ç½‘ç»œè¶…æ—¶
TypeError: MiniprogramApiTestHelper.mockWxRequestTimeout is not a function
 â¯ Function.simulateNetworkScenario tests/utils/page-test-helper.ts:388:34
    386|         break
    387|       case 'timeout':
    388|         MiniprogramApiTestHelper.mockWxRequestTimeout()
       |                                  ^
    389|         break
    390|     }
 â¯ tests/examples/page-test-example.test.ts:282:20
 â¯ tests/utils/page-test-helper.ts:460:13

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/38]â¯

 FAIL  tests/examples/page-test-example.test.ts > å°ç¨‹åºé¡µé¢æµ‹è¯•å·¥å…·ç¤ºä¾‹ > é¡µé¢çŠ¶æ€æµ‹è¯• > åº”è¯¥æ­£ç¡®æ˜¾ç¤ºåŠ è½½çŠ¶æ€
AssertionError: expected "spy" to be called with arguments: [ Array(1) ]

Received: 



Number of calls: 0

 â¯ Function.expectPageLoading tests/utils/page-test-helper.ts:309:30
    307|   ): void {
    308|     if (isLoading) {
    309|       expect(wx.showLoading).toHaveBeenCalledWith(
       |                              ^
    310|         expect.objectContaining({
    311|           title: loadingText
 â¯ tests/examples/page-test-example.test.ts:303:14
 â¯ tests/utils/page-test-helper.ts:460:13

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/38]â¯

 FAIL  tests/integration/employee-flow.test.ts > Employee Flow Integration Tests > Passcode Management > should handle passcode refresh failure
AssertionError: expected [Function] to throw error including 'æœåŠ¡å™¨é”™è¯¯ï¼Œæ— æ³•åˆ·æ–°é€šè¡Œç ' but got 'HTTP 500: [object Object]'

- Expected
+ Received

- æœåŠ¡å™¨é”™è¯¯ï¼Œæ— æ³•åˆ·æ–°é€šè¡Œç 
+ HTTP 500: [object Object]

 â¯ tests/integration/employee-flow.test.ts:335:7
    333|       });
    334| 
    335|       await expect(EmployeeService.refreshEmployeePasscode())
       |       ^
    336|         .rejects.toThrow('æœåŠ¡å™¨é”™è¯¯ï¼Œæ— æ³•åˆ·æ–°é€šè¡Œç ');
    337|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/38]â¯

 FAIL  tests/integration/employee-flow.test.ts > Employee Flow Integration Tests > Data Validation > should validate ID card format
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ tests/integration/employee-flow.test.ts:439:42
    437| 
    438|       invalidIdCards.forEach(idCard => {
    439|         expect(idCardRegex.test(idCard)).toBe(false);
       |                                          ^
    440|       });
    441|     });
 â¯ tests/integration/employee-flow.test.ts:438:22

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/38]â¯

 FAIL  tests/integration/visitor-flow.test.ts > Visitor Flow Integration Tests > Complete Visitor Application Flow > should handle usage limit exceeded
AssertionError: expected [Function] to throw error including 'é€šè¡Œç ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œæ— æ³•åˆ·æ–°' but got 'HTTP 400: [object Object]'

- Expected
+ Received

- é€šè¡Œç ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œæ— æ³•åˆ·æ–°
+ HTTP 400: [object Object]

 â¯ tests/integration/visitor-flow.test.ts:245:7
    243|       });
    244| 
    245|       await expect(VisitorService.refreshPasscode(1))
       |       ^
    246|         .rejects.toThrow('é€šè¡Œç ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œæ— æ³•åˆ·æ–°');
    247|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/38]â¯

 FAIL  tests/integration/visitor-flow.test.ts > Visitor Flow Integration Tests > Error Handling > should handle invalid application data
AssertionError: expected [Function] to throw error including 'ç”³è¯·æ•°æ®æ— æ•ˆ' but got 'HTTP 400: [object Object]'

- Expected
+ Received

- ç”³è¯·æ•°æ®æ— æ•ˆ
+ HTTP 400: [object Object]

 â¯ tests/integration/visitor-flow.test.ts:293:7
    291|       });
    292| 
    293|       await expect(VisitorService.submitApplication(invalidData))
       |       ^
    294|         .rejects.toThrow('ç”³è¯·æ•°æ®æ— æ•ˆ');
    295|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¾“å…¥äº‹ä»¶å¤„ç† > åº”è¯¥å¤„ç†è¾“å…¥äº‹ä»¶å¹¶æ›´æ–°å€¼
TypeError: this.setData is not a function
 â¯ Object.onInput tests/unit/components/form-field.test.ts:196:18
    194|           onInput(e) {
    195|             const value = e.detail.value;
    196|             this.setData({
       |                  ^
    197|               internalValue: value,
    198|               error: '',
 â¯ tests/unit/components/form-field.test.ts:212:34

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¾“å…¥äº‹ä»¶å¤„ç† > åº”è¯¥å¤„ç†ç„¦ç‚¹äº‹ä»¶
TypeError: this.setData is not a function
 â¯ Object.onFocus tests/unit/components/form-field.test.ts:231:18
    229|         methods: {
    230|           onFocus(e) {
    231|             this.setData({ focused: true });
       |                  ^
    232|             this.triggerEvent('focus', e.detail);
    233|           },
 â¯ tests/unit/components/form-field.test.ts:244:34

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¡¨å•éªŒè¯ > åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ
TypeError: Cannot read properties of undefined (reading 'required')
 â¯ Object.validate tests/unit/components/form-field.test.ts:270:33
    268|         methods: {
    269|           validate() {
    270|             if (this.properties.required && !this.properties.value.triâ€¦
       |                                 ^
    271|               const message = `${this.properties.label || 'æ­¤å­—æ®µ'}ä¸ºâ€¦
    272|               this.setData({
 â¯ tests/unit/components/form-field.test.ts:288:49

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¡¨å•éªŒè¯ > åº”è¯¥éªŒè¯å­—æ®µé•¿åº¦
TypeError: Cannot read properties of undefined (reading 'value')
 â¯ Object.validate tests/unit/components/form-field.test.ts:315:43
    313|         methods: {
    314|           validate() {
    315|             const value = this.properties.value;
       |                                           ^
    316|             const rules = this.properties.rules;
    317|             
 â¯ tests/unit/components/form-field.test.ts:345:49

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¡¨å•éªŒè¯ > åº”è¯¥éªŒè¯æ­£åˆ™è¡¨è¾¾å¼
TypeError: Cannot read properties of undefined (reading 'value')
 â¯ Object.validate tests/unit/components/form-field.test.ts:371:43
    369|         methods: {
    370|           validate() {
    371|             const value = this.properties.value;
       |                                           ^
    372|             const rules = this.properties.rules;
    373|             
 â¯ tests/unit/components/form-field.test.ts:393:49

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¡¨å•éªŒè¯ > åº”è¯¥æ”¯æŒè‡ªå®šä¹‰éªŒè¯å‡½æ•°
TypeError: Cannot read properties of undefined (reading 'value')
 â¯ Object.validate tests/unit/components/form-field.test.ts:424:43
    422|         methods: {
    423|           validate() {
    424|             const value = this.properties.value;
       |                                           ^
    425|             const rules = this.properties.rules;
    426|             
 â¯ tests/unit/components/form-field.test.ts:448:49

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > è¡¨å•éªŒè¯ > åº”è¯¥é€šè¿‡æ‰€æœ‰éªŒè¯è§„åˆ™
TypeError: Cannot read properties of undefined (reading 'value')
 â¯ Object.validate tests/unit/components/form-field.test.ts:475:43
    473|         methods: {
    474|           validate() {
    475|             const value = this.properties.value;
       |                                           ^
    476|             
    477|             // å¿…å¡«éªŒè¯
 â¯ tests/unit/components/form-field.test.ts:507:49

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > æ ·å¼è®¡ç®— > åº”è¯¥æ ¹æ®çŠ¶æ€è®¡ç®—è¾“å…¥æ¡†æ ·å¼
TypeError: Cannot read properties of undefined (reading 'focused')
 â¯ Object.computeInputClass tests/unit/components/form-field.test.ts:531:42
    529|           computeInputClass() {
    530|             const baseClass = 'form-field__input';
    531|             const focusClass = this.data.focused ? 'form-field__input-â€¦
       |                                          ^
    532|             const errorClass = this.data.showError ? 'form-field__inpuâ€¦
    533|             const disabledClass = this.properties.disabled ? 'form-fieâ€¦
 â¯ tests/unit/components/form-field.test.ts:544:34

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > æ ·å¼è®¡ç®— > åº”è¯¥è®¡ç®—æ ‡ç­¾æ ·å¼
TypeError: Cannot read properties of undefined (reading 'required')
 â¯ Object.computeLabelClass tests/unit/components/form-field.test.ts:562:51
    560|           computeLabelClass() {
    561|             const baseClass = 'form-field__label';
    562|             const requiredClass = this.properties.required ? 'form-fieâ€¦
       |                                                   ^
    563|             
    564|             const classes = [baseClass, requiredClass]
 â¯ tests/unit/components/form-field.test.ts:573:34

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > ä¸åŒå­—æ®µç±»å‹ > åº”è¯¥å¤„ç†æ–‡æœ¬åŸŸç±»å‹
AssertionError: expected "spy" to be called with arguments: [ { characterCount: 7 } ]

Received: 

  1st spy call:

  Array [
    Object {
-     "characterCount": 7,
+     "characterCount": 6,
    },
  ]


Number of calls: 1

 â¯ tests/unit/components/form-field.test.ts:702:42
    700|       formFieldComponent.updateCharacterCount();
    701| 
    702|       expect(formFieldComponent.setData).toHaveBeenCalledWith({
       |                                          ^
    703|         characterCount: 7
    704|       });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/38]â¯

 FAIL  tests/unit/components/form-field.test.ts > è¡¨å•å­—æ®µç»„ä»¶æµ‹è¯• > ä¸åŒå­—æ®µç±»å‹ > åº”è¯¥å¤„ç†æ•°å­—ç±»å‹
TypeError: Cannot read properties of undefined (reading 'type')
 â¯ Object.onInput tests/unit/components/form-field.test.ts:717:33
    715|             
    716|             // æ•°å­—ç±»å‹åªå…è®¸æ•°å­—
    717|             if (this.properties.type === 'number') {
       |                                 ^
    718|               value = value.replace(/[^\d]/g, '');
    719|             }
 â¯ tests/unit/components/form-field.test.ts:731:34

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[28/38]â¯

 FAIL  tests/unit/components/qr-code.test.ts > äºŒç»´ç ç»„ä»¶æµ‹è¯• > å±æ€§å˜åŒ–ç›‘å¬ > åº”è¯¥ç›‘å¬codeå±æ€§å˜åŒ–å¹¶é‡æ–°ç”ŸæˆäºŒç»´ç 
TypeError: [Function bound spy] is not a spy or a call to a spy!
 â¯ tests/unit/components/qr-code.test.ts:187:46
    185|       qrCodeComponent.observers.code.call(qrCodeComponent, 'NEW123');
    186| 
    187|       expect(qrCodeComponent.generateQRCode).toHaveBeenCalled();
       |                                              ^
    188|       expect(qrCodeComponent.setData).toHaveBeenCalledWith({ lastCode:â€¦
    189|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[29/38]â¯

 FAIL  tests/unit/components/qr-code.test.ts > äºŒç»´ç ç»„ä»¶æµ‹è¯• > å±æ€§å˜åŒ–ç›‘å¬ > åº”è¯¥ç›‘å¬sizeå±æ€§å˜åŒ–å¹¶é‡æ–°ç”ŸæˆäºŒç»´ç 
TypeError: [Function bound spy] is not a spy or a call to a spy!
 â¯ tests/unit/components/qr-code.test.ts:210:46
    208|       qrCodeComponent.observers.size.call(qrCodeComponent, 300);
    209| 
    210|       expect(qrCodeComponent.generateQRCode).toHaveBeenCalled();
       |                                              ^
    211|     });
    212|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[30/38]â¯

 FAIL  tests/unit/components/status-badge.test.ts > çŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯• > çŠ¶æ€é…ç½® > åº”è¯¥æ”¯æŒè‡ªå®šä¹‰çŠ¶æ€é…ç½®
AssertionError: expected "spy" to be called with arguments: [ { statusConfig: { â€¦(2) } } ]

Received: 

  1st spy call:

  Array [
    Object {
      "statusConfig": Object {
        "pending": Object {
          "text": "å¾…å®¡æ‰¹",
          "type": "warning",
        },
+       "type": [Function Object],
+       "value": Object {
          "processing": Object {
            "text": "å¤„ç†ä¸­",
            "type": "primary",
+         },
        },
      },
    },
  ]


Number of calls: 1

 â¯ tests/unit/components/status-badge.test.ts:396:44
    394|       statusBadgeComponent.mergeConfig.call(statusBadgeComponent);
    395| 
    396|       expect(statusBadgeComponent.setData).toHaveBeenCalledWith({
       |                                            ^
    397|         statusConfig: {
    398|           pending: { text: 'å¾…å®¡æ‰¹', type: 'warning' },

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[31/38]â¯

 FAIL  tests/unit/components/status-badge.test.ts > çŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯• > æ¡ä»¶æ¸²æŸ“ > åº”è¯¥æ ¹æ®çŠ¶æ€æ§åˆ¶æ˜¾ç¤ºéšè—
AssertionError: expected "spy" to be called with arguments: [ { visible: true } ]

Received: 

  1st spy call:

  Array [
    Object {
-     "visible": true,
+     "visible": "pending",
    },
  ]


Number of calls: 1

 â¯ tests/unit/components/status-badge.test.ts:510:44
    508|       statusBadgeComponent.updateVisibility.call(statusBadgeComponent);
    509| 
    510|       expect(statusBadgeComponent.setData).toHaveBeenCalledWith({
       |                                            ^
    511|         visible: true
    512|       });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[32/38]â¯

 FAIL  tests/unit/components/status-badge.test.ts > çŠ¶æ€å¾½ç« ç»„ä»¶æµ‹è¯• > æ¡ä»¶æ¸²æŸ“ > åº”è¯¥åœ¨çŠ¶æ€ä¸ºç©ºæ—¶éšè—ç»„ä»¶
AssertionError: expected "spy" to be called with arguments: [ { visible: false } ]

Received: 

  1st spy call:

  Array [
    Object {
-     "visible": false,
+     "visible": "",
    },
  ]


Number of calls: 1

 â¯ tests/unit/components/status-badge.test.ts:535:44
    533|       statusBadgeComponent.updateVisibility.call(statusBadgeComponent);
    534| 
    535|       expect(statusBadgeComponent.setData).toHaveBeenCalledWith({
       |                                            ^
    536|         visible: false
    537|       });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[33/38]â¯

 FAIL  tests/unit/services/api.test.ts > APIæœåŠ¡æµ‹è¯• > å¹¶å‘è¯·æ±‚ > åº”è¯¥æ”¯æŒå¹¶å‘è¯·æ±‚
AssertionError: expected 3 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 3

 â¯ tests/unit/services/api.test.ts:696:34
    694|       expect(results).toHaveLength(3);
    695|       expect(wx.request).toHaveBeenCalledTimes(3);
    696|       expect(results[0].data.id).toBe(1);
       |                                  ^
    697|       expect(results[1].data.id).toBe(2);
    698|       expect(results[2].data.id).toBe(3);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[34/38]â¯

 FAIL  tests/unit/services/notification.test.ts > é€šçŸ¥æœåŠ¡æµ‹è¯• > é€šçŸ¥æ•°æ®éªŒè¯ > åº”è¯¥å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œé•¿æ–‡æœ¬
AssertionError: expected 105 to be less than or equal to 104
 â¯ tests/unit/services/notification.test.ts:346:55
    344|         longReason
    345|       );
    346|       expect(notificationWithLongText.content.length).toBeLessThanOrEqâ€¦
       |                                                       ^
    347|     });
    348|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[35/38]â¯

 FAIL  tests/unit/utils/date.test.ts > æ—¥æœŸå·¥å…·å‡½æ•°æµ‹è¯• > è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç† > åº”è¯¥å¤„ç†ç©ºå€¼å’Œundefined
AssertionError: expected [Function] to not throw an error but 'Error: æ— æ•ˆçš„æ—¥æœŸ' was thrown

- Expected: 
undefined

+ Received: 
"Error: æ— æ•ˆçš„æ—¥æœŸ"

 â¯ tests/unit/utils/date.test.ts:326:60
    324|     it('åº”è¯¥å¤„ç†ç©ºå€¼å’Œundefined', () => {
    325|       expect(() => DateUtils.format(null as any)).not.toThrow();
    326|       expect(() => DateUtils.format(undefined as any)).not.toThrow();
       |                                                            ^
    327|       expect(DateUtils.format(null as any)).toBe('');
    328|       expect(DateUtils.format(undefined as any)).toBe('');

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[36/38]â¯

 FAIL  tests/unit/utils/storage.test.ts > æœ¬åœ°å­˜å‚¨å·¥å…·å‡½æ•°æµ‹è¯• > getBatch æ–¹æ³• > åº”è¯¥å¤„ç†è·å–å¼‚å¸¸
AssertionError: expected "spy" to be called with arguments: [ 'æ‰¹é‡è·å–æ•°æ®å¤±è´¥:', Any<Error> ]

Received: 

  1st spy call:

  Array [
-   "æ‰¹é‡è·å–æ•°æ®å¤±è´¥:",
-   Any<Error>,
+   "è·å–å­˜å‚¨æ•°æ®å¤±è´¥:",
+   [Error: è·å–å¤±è´¥],
  ]


Number of calls: 1

 â¯ tests/unit/utils/storage.test.ts:466:31
    464|       
    465|       expect(result).toEqual({});
    466|       expect(consoleErrorSpy).toHaveBeenCalledWith('æ‰¹é‡è·å–æ•°æ®å¤±è´¥:'â€¦
       |                               ^
    467|       
    468|       consoleErrorSpy.mockRestore();

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[37/38]â¯

 FAIL  tests/unit/utils/storage.test.ts > æœ¬åœ°å­˜å‚¨å·¥å…·å‡½æ•°æµ‹è¯• > getUsageRate æ–¹æ³• > åº”è¯¥å¤„ç†è·å–ä¿¡æ¯å¤±è´¥
AssertionError: expected "spy" to be called with arguments: [ 'è·å–å­˜å‚¨ä½¿ç”¨ç‡å¤±è´¥:', Any<Error> ]

Received: 

  1st spy call:

  Array [
-   "è·å–å­˜å‚¨ä½¿ç”¨ç‡å¤±è´¥:",
-   Any<Error>,
+   "è·å–å­˜å‚¨ä¿¡æ¯å¤±è´¥:",
+   [Error: è·å–ä¿¡æ¯å¤±è´¥],
  ]


Number of calls: 1

 â¯ tests/unit/utils/storage.test.ts:506:31
    504|       
    505|       expect(result).toBe(0);
    506|       expect(consoleErrorSpy).toHaveBeenCalledWith('è·å–å­˜å‚¨ä½¿ç”¨ç‡å¤±è´¥â€¦
       |                               ^
    507|       
    508|       consoleErrorSpy.mockRestore();

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[38/38]â¯

[2m Test Files [22m [1m[31m12 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (25)[39m
[2m      Tests [22m [1m[31m38 failed[39m[22m[2m | [22m[1m[32m420 passed[39m[22m[90m (458)[39m
[2m   Start at [22m 13:43:36
[2m   Duration [22m 22.01s[2m (transform 5.68s, setup 2.65s, collect 7.04s, tests 4.14s, environment 154.97s, prepare 24.96s)[22m

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
