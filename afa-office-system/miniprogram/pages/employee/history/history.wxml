<!--员工通行记录页面-->
<view class="container">
  <view class="header">
    <text class="title">通行记录</text>
    <text class="subtitle">查看您的通行历史</text>
  </view>

  <!-- 筛选器 -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{activeFilter === 'all' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="all"
      >
        全部
      </view>
      <view 
        class="filter-tab {{activeFilter === 'success' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="success"
      >
        成功
      </view>
      <view 
        class="filter-tab {{activeFilter === 'failed' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="failed"
      >
        失败
      </view>
    </view>
    
    <view class="filter-row">
      <view class="date-filter">
        <picker 
          mode="date" 
          value="{{startDate}}" 
          bindchange="onStartDateChange"
          class="date-picker"
        >
          <view class="picker-text">{{startDate || '开始日期'}}</view>
        </picker>
        <text class="date-separator">至</text>
        <picker 
          mode="date" 
          value="{{endDate}}" 
          bindchange="onEndDateChange"
          class="date-picker"
        >
          <view class="picker-text">{{endDate || '结束日期'}}</view>
        </picker>
      </view>
      
      <view class="direction-filter">
        <picker 
          range="{{directionOptions}}" 
          range-key="label"
          value="{{directionIndex}}"
          bindchange="onDirectionChange"
          class="direction-picker"
        >
          <view class="picker-text">{{directionOptions[directionIndex].label}}</view>
        </picker>
      </view>
    </view>
  </view>

  <!-- 今日统计 -->
  <view class="today-stats" wx:if="{{todayStats.total > 0}}">
    <view class="stats-title">今日统计</view>
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-number">{{todayStats.total}}</text>
        <text class="stat-label">总次数</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{todayStats.inCount}}</text>
        <text class="stat-label">进入</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{todayStats.outCount}}</text>
        <text class="stat-label">离开</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{todayStats.successRate}}%</text>
        <text class="stat-label">成功率</text>
      </view>
    </view>
  </view>

  <!-- 记录列表 -->
  <view class="records-section">
    <view class="records-list" wx:if="{{filteredRecords.length > 0}}">
      <view 
        class="record-item" 
        wx:for="{{filteredRecords}}" 
        wx:key="id"
      >
        <view class="record-header">
          <view class="record-time">{{item.timeText}}</view>
          <view class="record-direction direction-{{item.direction}}">
            {{item.direction === 'in' ? '进入' : '离开'}}
          </view>
          <view class="record-status status-{{item.result}}">
            {{item.result === 'success' ? '成功' : '失败'}}
          </view>
        </view>
        
        <view class="record-content">
          <view class="record-info">
            <text class="info-label">设备:</text>
            <text class="info-value">{{item.deviceType}} ({{item.deviceId}})</text>
          </view>
          
          <view class="record-info" wx:if="{{item.location}}">
            <text class="info-label">位置:</text>
            <text class="info-value">{{item.locationText}}</text>
          </view>
          
          <view class="record-info" wx:if="{{item.failReason}}">
            <text class="info-label">失败原因:</text>
            <text class="info-value error-text">{{item.failReason}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{filteredRecords.length === 0 && !loading}}">
      <view class="empty-icon"></view>
      <text class="empty-text">暂无通行记录</text>
      <text class="empty-subtitle">使用通行码后记录会显示在这里</text>
    </view>
  </view>

  <!-- 月度统计 -->
  <view class="monthly-stats" wx:if="{{records.length > 0}}">
    <view class="section-title">本月统计</view>
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{monthlyStats.total}}</text>
        <text class="stat-label">总通行次数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{monthlyStats.workDays}}</text>
        <text class="stat-label">工作天数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{monthlyStats.avgDaily}}</text>
        <text class="stat-label">日均通行</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{monthlyStats.successRate}}%</text>
        <text class="stat-label">成功率</text>
      </view>
    </view>
    
    <!-- 最近活跃时间 -->
    <view class="activity-info" wx:if="{{monthlyStats.lastActivity}}">
      <text class="activity-label">最近活跃:</text>
      <text class="activity-time">{{monthlyStats.lastActivity}}</text>
    </view>
  </view>
</view>

<!-- 加载提示 -->
<view class="loading-mask" wx:if="{{loading}}">
  <view class="loading-content">
    <text>加载中...</text>
  </view>
</view>