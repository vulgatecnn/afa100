# AFA 办公小程序高级功能需求文档

## 介绍

基于当前 MVP 版本的基础功能，本文档定义了 AFA 办公小程序的高级功能需求。这些功能将完善整个办公通行管理系统，包括高级权限管理、通行设备集成、人脸识别、访客黑名单管理、通行记录分析等企业级功能。

这些高级功能将使系统从基础的通行管理升级为完整的智能办公安全管理平台。

## 需求

### 需求 1 - 高级权限管理系统

**用户故事：** 作为租务管理员，我希望能够实现精细化的权限控制和角色管理，以便为不同层级的用户分配合适的系统权限。

#### 验收标准

1. WHEN 租务管理员创建角色 THEN 系统 SHALL 支持自定义角色名称和功能权限组合
2. WHEN 租务管理员分配角色权限 THEN 系统 SHALL 支持菜单级别和操作级别的权限控制
3. WHEN 商户管理员管理员工角色 THEN 系统 SHALL 只显示该商户范围内的角色和权限
4. WHEN 员工登录系统 THEN 系统 SHALL 根据其角色权限动态显示可用功能
5. WHEN 管理员修改角色权限 THEN 系统 SHALL 实时更新所有该角色用户的权限
6. IF 用户具有多个角色 THEN 系统 SHALL 合并所有角色的权限作为最终权限

### 需求 2 - 通行设备管理系统

**用户故事：** 作为租务管理员，我希望能够管理各种通行设备并配置设备参数，以便实现统一的设备管控和监控。

#### 验收标准

1. WHEN 租务管理员添加通行设备 THEN 系统 SHALL 支持设备基本信息录入和设备类型分类
2. WHEN 租务管理员配置设备参数 THEN 系统 SHALL 支持设置设备的通行规则和时间限制
3. WHEN 租务管理员管理设备类型 THEN 系统 SHALL 支持自定义设备类型和对应的验证方式
4. WHEN 租务管理员查看设备状态 THEN 系统 SHALL 显示设备在线状态和最后通信时间
5. WHEN 设备发生故障 THEN 系统 SHALL 记录故障信息并发送告警通知
6. IF 设备长时间离线 THEN 系统 SHALL 自动标记设备状态并通知管理员

### 需求 3 - 通行厂商对接管理

**用户故事：** 作为租务管理员，我希望能够管理不同的通行设备厂商并配置对接参数，以便支持多厂商设备的统一管理。

#### 验收标准

1. WHEN 租务管理员添加通行厂商 THEN 系统 SHALL 支持厂商基本信息和技术对接参数配置
2. WHEN 租务管理员配置厂商接口 THEN 系统 SHALL 支持不同厂商的 API 接口参数设置
3. WHEN 系统与厂商设备通信 THEN 系统 SHALL 根据厂商配置选择对应的通信协议
4. WHEN 厂商接口调用失败 THEN 系统 SHALL 记录失败日志并尝试重试机制
5. WHEN 租务管理员测试厂商连接 THEN 系统 SHALL 提供连接测试功能并显示测试结果

### 需求 4 - 访客黑名单管理

**用户故事：** 作为租务管理员，我希望能够管理访客黑名单，以便阻止不受欢迎的访客进入办公区域。

#### 验收标准

1. WHEN 租务管理员添加黑名单访客 THEN 系统 SHALL 支持通过手机号、身份证号等信息添加
2. WHEN 黑名单访客尝试预约 THEN 系统 SHALL 自动拒绝申请并提示相关信息
3. WHEN 商户尝试邀请黑名单访客 THEN 系统 SHALL 阻止邀请并通知商户管理员
4. WHEN 租务管理员查看黑名单记录 THEN 系统 SHALL 显示黑名单原因和添加时间
5. WHEN 租务管理员移除黑名单 THEN 系统 SHALL 恢复该访客的正常预约权限
6. IF 黑名单访客信息发生变更 THEN 系统 SHALL 支持黑名单信息的更新

### 需求 5 - 通行规则配置系统

**用户故事：** 作为租务管理员，我希望能够灵活配置各种通行规则，以便适应不同项目和商户的管理需求。

#### 验收标准

1. WHEN 租务管理员设置项目通行规则 THEN 系统 SHALL 支持员工通行码更新频率配置
2. WHEN 租务管理员设置访客规则 THEN 系统 SHALL 支持访客通行码使用次数和有效期配置
3. WHEN 租务管理员设置商户默认规则 THEN 系统 SHALL 为未配置规则的商户应用默认设置
4. WHEN 商户管理员自定义规则 THEN 系统 SHALL 优先使用商户专属规则覆盖默认规则
5. WHEN 规则发生冲突 THEN 系统 SHALL 按照优先级顺序应用最高优先级的规则
6. IF 规则配置无效 THEN 系统 SHALL 验证规则参数并提示错误信息

### 需求 6 - 人脸识别系统

**用户故事：** 作为商户员工，我希望能够使用人脸识别进行通行，以便提供更便捷和安全的通行体验。

#### 验收标准

1. WHEN 员工申请时上传人脸照片 THEN 系统 SHALL 验证照片质量并存储人脸特征数据
2. WHEN 硬件设备请求人脸数据 THEN 系统 SHALL 提供指定时间范围内的人脸照片更新
3. WHEN 设备识别到人脸 THEN 系统 SHALL 接收人脸 ID 并验证通行权限
4. WHEN 员工更新人脸照片 THEN 系统 SHALL 标记旧照片为删除状态并推送新照片给设备
5. WHEN 员工离职 THEN 系统 SHALL 自动将该员工的人脸数据标记为删除
6. IF 人脸照片不符合要求 THEN 系统 SHALL 拒绝上传并提示具体要求

### 需求 7 - 刷卡通行系统

**用户故事：** 作为商户员工，我希望能够使用实体卡片进行通行，以便在手机不便使用时仍能正常通行。

#### 验收标准

1. WHEN 商户管理员为员工分配卡片 THEN 系统 SHALL 建立员工与卡号的映射关系
2. WHEN 员工刷卡通行 THEN 系统 SHALL 根据卡号查找对应员工并验证通行权限
3. WHEN 卡片丢失 THEN 系统 SHALL 支持卡片挂失并阻止该卡的通行权限
4. WHEN 员工更换卡片 THEN 系统 SHALL 支持卡号变更并更新映射关系
5. WHEN 系统验证刷卡权限 THEN 系统 SHALL 记录刷卡通行日志包含卡号信息
6. IF 卡号未绑定员工 THEN 系统 SHALL 拒绝通行并记录未授权刷卡尝试

### 需求 8 - 通行记录分析系统

**用户故事：** 作为租务管理员，我希望能够查看和分析通行记录，以便了解办公区域的使用情况和安全状况。

#### 验收标准

1. WHEN 租务管理员查看通行记录 THEN 系统 SHALL 显示所有项目下设备的通行记录
2. WHEN 租务管理员筛选记录 THEN 系统 SHALL 支持按时间、人员、设备、方向等条件筛选
3. WHEN 租务管理员导出记录 THEN 系统 SHALL 支持 Excel 格式的记录导出功能
4. WHEN 租务管理员查看统计报表 THEN 系统 SHALL 提供通行频次和时段分析图表
5. WHEN 发生异常通行 THEN 系统 SHALL 在记录中标记异常并支持异常记录查询
6. IF 记录数据量过大 THEN 系统 SHALL 支持分页查询和数据归档功能

### 需求 9 - 访客邀约系统

**用户故事：** 作为商户员工，我希望能够主动邀请访客并发送通行码，以便为重要客户提供更便捷的访问体验。

#### 验收标准

1. WHEN 员工发起访客邀约 THEN 系统 SHALL 支持填写访客信息和访问安排
2. WHEN 系统生成邀约码 THEN 系统 SHALL 通过短信将临时通行码发送给被邀约访客
3. WHEN 访客收到邀约 THEN 系统 SHALL 在短信中包含通行码和访问指引信息
4. WHEN 邀约需要审批 THEN 系统 SHALL 根据商户审批设置决定是否需要管理员审批
5. WHEN 邀约码使用 THEN 系统 SHALL 记录邀约通行日志并关联邀请人信息
6. IF 邀约码过期 THEN 系统 SHALL 自动失效码并通知相关人员

### 需求 10 - 访客表单配置系统

**用户故事：** 作为商户管理员，我希望能够自定义访客申请表单，以便收集符合我们业务需求的访客信息。

#### 验收标准

1. WHEN 商户管理员配置表单字段 THEN 系统 SHALL 支持添加、删除、修改表单字段
2. WHEN 商户管理员设置字段属性 THEN 系统 SHALL 支持必填、可选、字段类型等属性设置
3. WHEN 访客填写申请表单 THEN 系统 SHALL 根据商户配置动态生成表单界面
4. WHEN 系统验证表单数据 THEN 系统 SHALL 根据字段配置进行数据格式和必填验证
5. WHEN 商户查看访客信息 THEN 系统 SHALL 按照表单配置展示访客提交的信息
6. IF 表单配置发生变更 THEN 系统 SHALL 保持历史申请数据的完整性

### 需求 11 - 短信通知系统

**用户故事：** 作为系统用户，我希望能够通过短信接收重要通知，以便及时了解申请状态和通行信息。

#### 验收标准

1. WHEN 系统需要发送短信 THEN 系统 SHALL 支持阿里云和腾讯云短信平台
2. WHEN 访客申请获得批准 THEN 系统 SHALL 自动发送包含通行码的短信通知
3. WHEN 员工申请状态变更 THEN 系统 SHALL 发送申请结果通知短信
4. WHEN 管理员配置短信模板 THEN 系统 SHALL 支持自定义短信内容模板
5. WHEN 短信发送失败 THEN 系统 SHALL 记录失败原因并支持重发机制
6. IF 短信配额不足 THEN 系统 SHALL 通知管理员并记录发送失败日志

### 需求 12 - 硬件设备 API 接口

**用户故事：** 作为硬件设备厂商，我希望能够通过标准 API 接口与系统集成，以便实现设备与管理系统的数据同步。

#### 验收标准

1. WHEN 设备请求人脸照片 THEN 系统 SHALL 提供按设备 ID 和时间范围的人脸数据接口
2. WHEN 设备验证通行权限 THEN 系统 SHALL 提供统一的用户校验接口支持多种验证方式
3. WHEN 设备上报通行记录 THEN 系统 SHALL 接收并存储设备上报的通行日志
4. WHEN 接口调用异常 THEN 系统 SHALL 返回标准的错误码和错误信息
5. WHEN 设备请求数据更新 THEN 系统 SHALL 支持增量数据同步减少传输量
6. IF 接口认证失败 THEN 系统 SHALL 拒绝请求并记录安全日志
