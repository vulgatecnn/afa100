name: TypeScript ç±»å‹æ£€æŸ¥

on:
  push:
    branches: [main, develop]
    paths:
      - 'afa-office-system/**/*.ts'
      - 'afa-office-system/**/*.tsx'
      - 'afa-office-system/**/tsconfig*.json'
      - 'shared/**/*.ts'
      - '.github/workflows/typescript-type-check.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'afa-office-system/**/*.ts'
      - 'afa-office-system/**/*.tsx'
      - 'afa-office-system/**/tsconfig*.json'
      - 'shared/**/*.ts'
      - '.github/workflows/typescript-type-check.yml'
  workflow_dispatch:
    inputs:
      strict_mode:
        description: 'ä¸¥æ ¼æ¨¡å¼ (é˜»æ–­æ„å»º)'
        required: false
        default: 'false'
        type: boolean
      generate_baseline:
        description: 'ç”Ÿæˆæ–°çš„ç±»å‹æ£€æŸ¥åŸºå‡†'
        required: false
        default: 'false'
        type: boolean

env:
  NODE_VERSION: '20.x'
  PNPM_VERSION: '8'

jobs:
  # TypeScript ç±»å‹æ£€æŸ¥
  typescript-check:
    name: TypeScript ç±»å‹æ£€æŸ¥
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        project: [backend, frontend-tenant, frontend-merchant]
        include:
          - project: backend
            path: afa-office-system/backend
            config: tsconfig.test.json
          - project: frontend-tenant
            path: afa-office-system/frontend/tenant-admin
            config: tsconfig.json
          - project: frontend-merchant
            path: afa-office-system/frontend/merchant-admin
            config: tsconfig.json

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: è®¾ç½®pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: ç¼“å­˜ä¾èµ–
        uses: actions/cache@v4
        with:
          path: |
            ~/.pnpm-store
            node_modules
            ${{ matrix.path }}/node_modules
          key: ${{ runner.os }}-pnpm-${{ matrix.project }}-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-${{ matrix.project }}-
            ${{ runner.os }}-pnpm-

      - name: å®‰è£…ä¾èµ–
        run: pnpm install --no-frozen-lockfile

      - name: å®‰è£…é¡¹ç›®ä¾èµ–
        working-directory: ${{ matrix.path }}
        run: |
          if [ -f "package.json" ]; then
            pnpm install --no-frozen-lockfile
          fi

      - name: æ£€æŸ¥ TypeScript é…ç½®
        working-directory: ${{ matrix.path }}
        run: |
          echo "::group::TypeScript é…ç½®æ£€æŸ¥"
          echo "å½“å‰ç›®å½•: $(pwd)"
          echo "TypeScript é…ç½®æ–‡ä»¶:"
          ls -la tsconfig*.json || echo "æœªæ‰¾åˆ° TypeScript é…ç½®æ–‡ä»¶"
          
          if [ -f "${{ matrix.config }}" ]; then
            echo "ä½¿ç”¨é…ç½®æ–‡ä»¶: ${{ matrix.config }}"
            cat ${{ matrix.config }}
          else
            echo "é…ç½®æ–‡ä»¶ ${{ matrix.config }} ä¸å­˜åœ¨"
          fi
          echo "::endgroup::"

      - name: è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥
        working-directory: ${{ matrix.path }}
        id: type-check
        continue-on-error: true
        run: |
          echo "::group::TypeScript ç±»å‹æ£€æŸ¥ - ${{ matrix.project }}"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰ type-check è„šæœ¬
          if [ -f "package.json" ] && grep -q "type-check" package.json; then
            echo "ä½¿ç”¨ package.json ä¸­çš„ type-check è„šæœ¬"
            pnpm type-check 2>&1 | tee type-check-output.log
            TYPE_CHECK_EXIT_CODE=${PIPESTATUS[0]}
          else
            echo "ç›´æ¥è¿è¡Œ tsc å‘½ä»¤"
            if [ -f "${{ matrix.config }}" ]; then
              npx tsc --noEmit --project ${{ matrix.config }} 2>&1 | tee type-check-output.log
              TYPE_CHECK_EXIT_CODE=${PIPESTATUS[0]}
            else
              echo "æœªæ‰¾åˆ° TypeScript é…ç½®æ–‡ä»¶ï¼Œè·³è¿‡ç±»å‹æ£€æŸ¥"
              TYPE_CHECK_EXIT_CODE=0
            fi
          fi
          
          echo "type_check_exit_code=$TYPE_CHECK_EXIT_CODE" >> $GITHUB_OUTPUT
          echo "::endgroup::"

      - name: è¿è¡Œç±»å‹æ£€æŸ¥éªŒè¯è„šæœ¬ (ä»…åç«¯)
        if: matrix.project == 'backend'
        working-directory: ${{ matrix.path }}
        continue-on-error: true
        run: |
          echo "::group::ç±»å‹æ£€æŸ¥éªŒè¯è„šæœ¬"
          if [ -f "scripts/type-check-validation.js" ]; then
            node scripts/type-check-validation.js
            echo "ç±»å‹æ£€æŸ¥éªŒè¯å®Œæˆ"
          else
            echo "ç±»å‹æ£€æŸ¥éªŒè¯è„šæœ¬ä¸å­˜åœ¨"
          fi
          echo "::endgroup::"

      - name: è§£æç±»å‹é”™è¯¯
        working-directory: ${{ matrix.path }}
        if: always()
        run: |
          echo "::group::ç±»å‹é”™è¯¯ç»Ÿè®¡"
          
          if [ -f "type-check-output.log" ]; then
            # ç»Ÿè®¡é”™è¯¯æ•°é‡
            ERROR_COUNT=$(grep -c "error TS" type-check-output.log || echo "0")
            WARNING_COUNT=$(grep -c "warning TS" type-check-output.log || echo "0")
            
            echo "TypeScript é”™è¯¯æ•°é‡: $ERROR_COUNT"
            echo "TypeScript è­¦å‘Šæ•°é‡: $WARNING_COUNT"
            
            # ç”Ÿæˆé”™è¯¯æ‘˜è¦
            echo "## TypeScript ç±»å‹æ£€æŸ¥ç»“æœ - ${{ matrix.project }}" >> type-check-summary.md
            echo "" >> type-check-summary.md
            echo "- é”™è¯¯æ•°é‡: $ERROR_COUNT" >> type-check-summary.md
            echo "- è­¦å‘Šæ•°é‡: $WARNING_COUNT" >> type-check-summary.md
            echo "- æ£€æŸ¥çŠ¶æ€: ${{ steps.type-check.outputs.type_check_exit_code == '0' && 'âœ… é€šè¿‡' || 'âŒ å¤±è´¥' }}" >> type-check-summary.md
            echo "" >> type-check-summary.md
            
            if [ "$ERROR_COUNT" -gt "0" ]; then
              echo "### é”™è¯¯è¯¦æƒ…" >> type-check-summary.md
              echo '```' >> type-check-summary.md
              grep "error TS" type-check-output.log | head -20 >> type-check-summary.md
              if [ "$ERROR_COUNT" -gt "20" ]; then
                echo "... è¿˜æœ‰ $((ERROR_COUNT - 20)) ä¸ªé”™è¯¯" >> type-check-summary.md
              fi
              echo '```' >> type-check-summary.md
            fi
            
            # è®¾ç½® GitHub è¾“å‡º
            echo "error_count=$ERROR_COUNT" >> $GITHUB_OUTPUT
            echo "warning_count=$WARNING_COUNT" >> $GITHUB_OUTPUT
          else
            echo "æœªæ‰¾åˆ°ç±»å‹æ£€æŸ¥è¾“å‡ºæ–‡ä»¶"
            echo "error_count=0" >> $GITHUB_OUTPUT
            echo "warning_count=0" >> $GITHUB_OUTPUT
          fi
          
          echo "::endgroup::"

      - name: ç”Ÿæˆç±»å‹æ£€æŸ¥æŠ¥å‘Š (ä»…åç«¯)
        if: matrix.project == 'backend' && always()
        working-directory: ${{ matrix.path }}
        run: |
          echo "::group::ç”Ÿæˆç±»å‹æ£€æŸ¥æŠ¥å‘Š"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æŠ¥å‘Šæ–‡ä»¶
          if [ -f "type-check-report.json" ]; then
            echo "å‘ç°ç±»å‹æ£€æŸ¥æŠ¥å‘Šæ–‡ä»¶"
            
            # æå–å…³é”®ä¿¡æ¯
            TOTAL_ERRORS=$(cat type-check-report.json | jq -r '.totalErrors // 0')
            FILES_WITH_ERRORS=$(cat type-check-report.json | jq -r '.summary.filesWithErrors // 0')
            DURATION=$(cat type-check-report.json | jq -r '.summary.duration // "æœªçŸ¥"')
            
            echo "æ€»é”™è¯¯æ•°: $TOTAL_ERRORS"
            echo "æœ‰é”™è¯¯çš„æ–‡ä»¶æ•°: $FILES_WITH_ERRORS"
            echo "æ£€æŸ¥è€—æ—¶: $DURATION"
            
            # æ·»åŠ åˆ°æ‘˜è¦
            echo "" >> type-check-summary.md
            echo "### è¯¦ç»†ç»Ÿè®¡" >> type-check-summary.md
            echo "- æ€»é”™è¯¯æ•°: $TOTAL_ERRORS" >> type-check-summary.md
            echo "- æœ‰é”™è¯¯çš„æ–‡ä»¶æ•°: $FILES_WITH_ERRORS" >> type-check-summary.md
            echo "- æ£€æŸ¥è€—æ—¶: $DURATION" >> type-check-summary.md
          fi
          
          echo "::endgroup::"

      - name: ä¸Šä¼ ç±»å‹æ£€æŸ¥æŠ¥å‘Š
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: typescript-check-${{ matrix.project }}
          path: |
            ${{ matrix.path }}/type-check-output.log
            ${{ matrix.path }}/type-check-summary.md
            ${{ matrix.path }}/type-check-report.json
            ${{ matrix.path }}/type-check-results.log
            ${{ matrix.path }}/type-check-baseline.json
          retention-days: 30

      - name: æ£€æŸ¥ç±»å‹é”™è¯¯é˜»æ–­
        if: steps.type-check.outputs.type_check_exit_code != '0'
        run: |
          echo "::error::TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥ - ${{ matrix.project }}"
          
          if [ "${{ github.event.inputs.strict_mode }}" == "true" ]; then
            echo "ä¸¥æ ¼æ¨¡å¼å·²å¯ç”¨ï¼Œæ„å»ºå°†è¢«é˜»æ–­"
            exit 1
          else
            echo "éä¸¥æ ¼æ¨¡å¼ï¼Œå…è®¸ç»§ç»­æ„å»ºä½†ä¼šè®°å½•é”™è¯¯"
            echo "::warning::TypeScript ç±»å‹æ£€æŸ¥å­˜åœ¨é”™è¯¯ï¼Œå»ºè®®ä¿®å¤"
          fi

  # ç±»å‹å›å½’æµ‹è¯• (ä»…åç«¯)
  type-regression-test:
    name: ç±»å‹å›å½’æµ‹è¯•
    runs-on: ubuntu-latest
    needs: typescript-check
    if: always()
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: è®¾ç½®pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: å®‰è£…ä¾èµ–
        run: pnpm install --no-frozen-lockfile

      - name: å®‰è£…åç«¯ä¾èµ–
        working-directory: afa-office-system/backend
        run: pnpm install --no-frozen-lockfile

      - name: ä¸‹è½½ç±»å‹æ£€æŸ¥æŠ¥å‘Š
        uses: actions/download-artifact@v4
        with:
          name: typescript-check-backend
          path: afa-office-system/backend/

      - name: è¿è¡Œç±»å‹å›å½’æµ‹è¯•
        working-directory: afa-office-system/backend
        continue-on-error: true
        run: |
          echo "::group::ç±»å‹å›å½’æµ‹è¯•"
          
          if [ -f "scripts/type-regression-test.js" ]; then
            node scripts/type-regression-test.js
          else
            echo "ç±»å‹å›å½’æµ‹è¯•è„šæœ¬ä¸å­˜åœ¨ï¼Œè·³è¿‡å›å½’æµ‹è¯•"
          fi
          
          echo "::endgroup::"

      - name: ç”Ÿæˆæ–°åŸºå‡† (å¦‚æœéœ€è¦)
        if: github.event.inputs.generate_baseline == 'true'
        working-directory: afa-office-system/backend
        run: |
          echo "::group::ç”Ÿæˆæ–°çš„ç±»å‹æ£€æŸ¥åŸºå‡†"
          
          if [ -f "scripts/type-check-validation.js" ]; then
            node scripts/type-check-validation.js --setup-regression
            echo "æ–°åŸºå‡†å·²ç”Ÿæˆ"
          else
            echo "ç±»å‹æ£€æŸ¥éªŒè¯è„šæœ¬ä¸å­˜åœ¨"
          fi
          
          echo "::endgroup::"

      - name: ä¸Šä¼ å›å½’æµ‹è¯•ç»“æœ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: type-regression-results
          path: |
            afa-office-system/backend/type-check-baseline.json
            afa-office-system/backend/type-check-report.json
          retention-days: 90

  # ç±»å‹è´¨é‡ç›‘æ§ä»ªè¡¨æ¿
  type-quality-dashboard:
    name: ç±»å‹è´¨é‡ç›‘æ§
    runs-on: ubuntu-latest
    needs: [typescript-check, type-regression-test]
    if: always()
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ä¸‹è½½æ‰€æœ‰ç±»å‹æ£€æŸ¥æŠ¥å‘Š
        uses: actions/download-artifact@v4
        with:
          path: type-check-reports

      - name: ç”Ÿæˆç±»å‹è´¨é‡ä»ªè¡¨æ¿
        run: |
          echo "# TypeScript ç±»å‹è´¨é‡ä»ªè¡¨æ¿" > type-quality-dashboard.md
          echo "" >> type-quality-dashboard.md
          echo "## æ£€æŸ¥æ—¶é—´" >> type-quality-dashboard.md
          echo "- æ£€æŸ¥æ—¶é—´: $(date -u +%Y-%m-%dT%H:%M:%SZ)" >> type-quality-dashboard.md
          echo "- åˆ†æ”¯: ${{ github.ref_name }}" >> type-quality-dashboard.md
          echo "- æäº¤: ${{ github.sha }}" >> type-quality-dashboard.md
          echo "- è§¦å‘äº‹ä»¶: ${{ github.event_name }}" >> type-quality-dashboard.md
          echo "" >> type-quality-dashboard.md
          
          echo "## é¡¹ç›®ç±»å‹æ£€æŸ¥çŠ¶æ€" >> type-quality-dashboard.md
          echo "| é¡¹ç›® | çŠ¶æ€ | é”™è¯¯æ•° | è­¦å‘Šæ•° |" >> type-quality-dashboard.md
          echo "|------|------|--------|--------|" >> type-quality-dashboard.md
          
          # å¤„ç†åç«¯æŠ¥å‘Š
          if [ -f "type-check-reports/typescript-check-backend/type-check-report.json" ]; then
            BACKEND_ERRORS=$(cat type-check-reports/typescript-check-backend/type-check-report.json | jq -r '.totalErrors // 0')
            BACKEND_STATUS=$([ "$BACKEND_ERRORS" -eq "0" ] && echo "âœ… é€šè¿‡" || echo "âŒ å¤±è´¥")
            echo "| åç«¯ | $BACKEND_STATUS | $BACKEND_ERRORS | - |" >> type-quality-dashboard.md
          else
            echo "| åç«¯ | âš ï¸ æœªæ£€æŸ¥ | - | - |" >> type-quality-dashboard.md
          fi
          
          # å¤„ç†å‰ç«¯æŠ¥å‘Š
          for frontend in tenant merchant; do
            if [ -f "type-check-reports/typescript-check-frontend-$frontend/type-check-summary.md" ]; then
              echo "| å‰ç«¯-$frontend | âœ… å·²æ£€æŸ¥ | - | - |" >> type-quality-dashboard.md
            else
              echo "| å‰ç«¯-$frontend | âš ï¸ æœªæ£€æŸ¥ | - | - |" >> type-quality-dashboard.md
            fi
          done
          
          echo "" >> type-quality-dashboard.md
          
          # æ·»åŠ è¶‹åŠ¿åˆ†æ
          echo "## ç±»å‹é”™è¯¯è¶‹åŠ¿" >> type-quality-dashboard.md
          if [ -f "type-check-reports/typescript-check-backend/type-check-report.json" ]; then
            echo "### åç«¯ç±»å‹é”™è¯¯åˆ†ç±»" >> type-quality-dashboard.md
            cat type-check-reports/typescript-check-backend/type-check-report.json | jq -r '
              .errorsByCategory | to_entries | 
              map("- " + .key + ": " + (.value | tostring) + " ä¸ªé”™è¯¯") | 
              .[]
            ' >> type-quality-dashboard.md 2>/dev/null || echo "- æ— æ³•è§£æé”™è¯¯åˆ†ç±»æ•°æ®" >> type-quality-dashboard.md
          fi
          
          echo "" >> type-quality-dashboard.md
          echo "## å»ºè®®" >> type-quality-dashboard.md
          
          # æ ¹æ®é”™è¯¯æ•°é‡ç»™å‡ºå»ºè®®
          if [ -f "type-check-reports/typescript-check-backend/type-check-report.json" ]; then
            TOTAL_ERRORS=$(cat type-check-reports/typescript-check-backend/type-check-report.json | jq -r '.totalErrors // 0')
            
            if [ "$TOTAL_ERRORS" -eq "0" ]; then
              echo "ğŸ‰ æ­å–œï¼æ‰€æœ‰ TypeScript ç±»å‹æ£€æŸ¥éƒ½é€šè¿‡äº†ã€‚" >> type-quality-dashboard.md
            elif [ "$TOTAL_ERRORS" -lt "50" ]; then
              echo "âš ï¸ å‘ç°å°‘é‡ç±»å‹é”™è¯¯ï¼Œå»ºè®®ä¼˜å…ˆä¿®å¤ã€‚" >> type-quality-dashboard.md
            elif [ "$TOTAL_ERRORS" -lt "200" ]; then
              echo "ğŸ”§ å‘ç°ä¸­ç­‰æ•°é‡çš„ç±»å‹é”™è¯¯ï¼Œå»ºè®®åˆ†æ‰¹ä¿®å¤ã€‚" >> type-quality-dashboard.md
            else
              echo "ğŸš¨ å‘ç°å¤§é‡ç±»å‹é”™è¯¯ï¼Œå»ºè®®åˆ¶å®šç³»ç»Ÿæ€§ä¿®å¤è®¡åˆ’ã€‚" >> type-quality-dashboard.md
            fi
          fi
          
          echo "" >> type-quality-dashboard.md
          echo "## è¯¦ç»†æŠ¥å‘Š" >> type-quality-dashboard.md
          echo "è¯¦ç»†çš„ç±»å‹æ£€æŸ¥æŠ¥å‘Šè¯·æŸ¥çœ‹ CI æ„å»ºçš„ Artifactsã€‚" >> type-quality-dashboard.md

      - name: ä¸Šä¼ ç±»å‹è´¨é‡ä»ªè¡¨æ¿
        uses: actions/upload-artifact@v4
        with:
          name: type-quality-dashboard
          path: |
            type-quality-dashboard.md
            type-check-reports/
          retention-days: 90

      - name: è¾“å‡ºä»ªè¡¨æ¿æ‘˜è¦
        run: |
          echo "::group::ç±»å‹è´¨é‡ä»ªè¡¨æ¿æ‘˜è¦"
          cat type-quality-dashboard.md
          echo "::endgroup::"

  # ç±»å‹æ£€æŸ¥ç»“æœé€šçŸ¥
  type-check-notification:
    name: ç±»å‹æ£€æŸ¥ç»“æœé€šçŸ¥
    runs-on: ubuntu-latest
    needs: [typescript-check, type-regression-test, type-quality-dashboard]
    if: always()
    
    steps:
      - name: è¯„ä¼°æ•´ä½“çŠ¶æ€
        id: overall-status
        run: |
          # æ£€æŸ¥å„ä¸ªä½œä¸šçš„çŠ¶æ€
          TYPESCRIPT_CHECK_STATUS="${{ needs.typescript-check.result }}"
          REGRESSION_TEST_STATUS="${{ needs.type-regression-test.result }}"
          DASHBOARD_STATUS="${{ needs.type-quality-dashboard.result }}"
          
          echo "TypeScript æ£€æŸ¥çŠ¶æ€: $TYPESCRIPT_CHECK_STATUS"
          echo "å›å½’æµ‹è¯•çŠ¶æ€: $REGRESSION_TEST_STATUS"
          echo "ä»ªè¡¨æ¿çŠ¶æ€: $DASHBOARD_STATUS"
          
          # ç¡®å®šæ•´ä½“çŠ¶æ€
          if [ "$TYPESCRIPT_CHECK_STATUS" == "success" ]; then
            OVERALL_STATUS="success"
            STATUS_EMOJI="âœ…"
            STATUS_MESSAGE="TypeScript ç±»å‹æ£€æŸ¥å…¨éƒ¨é€šè¿‡"
          elif [ "$TYPESCRIPT_CHECK_STATUS" == "failure" ]; then
            if [ "${{ github.event.inputs.strict_mode }}" == "true" ]; then
              OVERALL_STATUS="failure"
              STATUS_EMOJI="âŒ"
              STATUS_MESSAGE="TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥ (ä¸¥æ ¼æ¨¡å¼)"
            else
              OVERALL_STATUS="warning"
              STATUS_EMOJI="âš ï¸"
              STATUS_MESSAGE="TypeScript ç±»å‹æ£€æŸ¥å­˜åœ¨é”™è¯¯ (éä¸¥æ ¼æ¨¡å¼)"
            fi
          else
            OVERALL_STATUS="unknown"
            STATUS_EMOJI="â“"
            STATUS_MESSAGE="TypeScript ç±»å‹æ£€æŸ¥çŠ¶æ€æœªçŸ¥"
          fi
          
          echo "overall_status=$OVERALL_STATUS" >> $GITHUB_OUTPUT
          echo "status_emoji=$STATUS_EMOJI" >> $GITHUB_OUTPUT
          echo "status_message=$STATUS_MESSAGE" >> $GITHUB_OUTPUT

      - name: å‘é€é€šçŸ¥
        run: |
          echo "${{ steps.overall-status.outputs.status_emoji }} ${{ steps.overall-status.outputs.status_message }}"
          
          # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„é€šçŸ¥é€»è¾‘
          # ä¾‹å¦‚å‘é€åˆ° Slackã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰
          
          if [ "${{ steps.overall-status.outputs.overall_status }}" == "failure" ]; then
            echo "::error::TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š"
            exit 1
          elif [ "${{ steps.overall-status.outputs.overall_status }}" == "warning" ]; then
            echo "::warning::TypeScript ç±»å‹æ£€æŸ¥å­˜åœ¨é—®é¢˜ï¼Œå»ºè®®ä¿®å¤"
          else
            echo "::notice::TypeScript ç±»å‹æ£€æŸ¥å®Œæˆ"
          fi