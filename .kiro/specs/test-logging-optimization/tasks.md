# 测试输出优化实施计划

- [x] 1. 创建测试脚本基础架构

  - 为后端、前端和小程序创建统一的测试运行器脚本
  - 实现日志目录自动创建和基础文件管理功能
  - 配置命令行参数解析和基础的输出控制逻辑
  - _需求: 1.1, 4.1, 6.1_

- [x] 1.1 创建统一测试运行器脚本

  - 在 `afa-office-system/scripts/` 目录下创建 `test-runner.js`
  - 实现命令行参数解析 (--verbose, --silent, --debug, --coverage, --module, --parallel)
  - 实现跨模块的测试执行和输出重定向逻辑
  - _需求: 1.1, 4.1_

- [x] 1.2 实现日志管理系统

  - 创建 `scripts/utils/log-manager.js` 日志管理工具
  - 实现统一的日志目录创建和文件管理功能
  - 支持模块级别的日志文件操作和清理
  - _需求: 6.1, 6.2_

- [x] 1.3 创建摘要生成系统

  - 创建 `scripts/utils/summary-generator.js` 摘要生成器
  - 实现项目级别的测试结果汇总和错误聚合
  - 支持多种输出格式 (控制台、文件、JSON)
  - _需求: 1.3, 3.1, 3.2_

- [x] 2. 实现各模块测试输出解析和处理

  - 创建适配不同测试框架的输出解析器
  - 实现统一的错误信息提取和格式化功能
  - 创建覆盖率数据解析和处理逻辑
  - _需求: 2.1, 2.2, 3.1, 5.1_

- [x] 2.1 创建后端输出解析器

  - 创建 `scripts/parsers/backend-parser.js` 文件
  - 实现从 vitest 输出中提取测试统计信息的功能
  - 解析测试通过/失败数量、执行时间、错误详情和覆盖率数据
  - _需求: 1.2, 2.1, 2.2, 3.1_

- [x] 2.2 创建前端输出解析器

  - 创建 `scripts/parsers/frontend-parser.js` 文件
  - 适配 React 测试环境，支持 Vitest 和 Jest 框架
  - 处理前端组件测试的特有输出格式和错误信息
  - _需求: 1.2, 2.1, 2.2, 3.1_

- [x] 2.3 创建小程序输出解析器

  - 创建 `scripts/parsers/miniprogram-parser.js` 文件
  - 适配小程序测试框架的输出格式
  - 处理小程序特有的测试场景和错误类型 (wx API、组件、页面)
  - _需求: 1.2, 2.1, 2.2, 3.1_

- [x] 3. 更新项目配置和脚本

  - 更新 `package.json` 中的测试脚本配置
  - 确保新脚本与现有工作流程兼容
  - 实现跨模块的测试执行和日志聚合
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 3.1 更新根目录 package.json 测试脚本

  - 修改项目根目录 `package.json` 中的测试脚本
  - 添加统一的 test, test:verbose, test:silent, test:coverage, test:parallel 等命令
  - 实现模块级别的测试执行命令 (test:backend, test:frontend, test:miniprogram)
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [-] 4. 测试和验证优化效果



  - 验证控制台输出的简洁性和可读性
  - 测试日志文件的完整性和 AI 可读性
  - 确保所有测试功能正常工作
  - _需求: 所有需求的验证_

- [x] 4.1 验证统一测试运行器功能

  - 运行 `pnpm test` 验证跨模块测试执行
  - 测试不同参数组合 (--verbose, --silent, --coverage, --parallel)
  - 验证模块级别测试执行 (--module=backend 等)
  - _需求: 1.1, 4.1, 4.2, 4.3, 4.4_

- [x] 4.2 测试日志文件生成和结构


  - 验证 `logs/` 目录结构自动创建
  - 确认各模块日志文件正确生成 (backend/, frontend-tenant/, frontend-merchant/, miniprogram/)
  - 检查项目级别摘要文件生成 (summary/overall-summary.txt, all-errors-summary.txt)
  - _需求: 2.1, 2.2, 3.1, 3.2, 6.1, 6.2_

- [x] 4.3 验证错误解析和摘要生成




  - 故意引入测试失败，验证错误信息提取准确性
  - 检查 AI 可读的错误摘要文件格式和内容
  - 验证不同模块错误信息的正确聚合
  - _需求: 2.2, 3.1, 3.2, 3.3_

- [x] 4.4 测试覆盖率报告处理


  - 运行 `pnpm test:coverage` 验证覆盖率数据提取
  - 检查覆盖率摘要文件的生成和格式
  - 验证控制台覆盖率信息的简洁显示
  - _需求: 5.1, 5.2_

- [ ] 4.5 完善覆盖率数据解析和显示




  - 修复后端解析器中的覆盖率数据提取逻辑
  - 确保覆盖率信息正确显示在控制台摘要中
  - 验证覆盖率详细报告文件的生成
  - 测试前端和小程序模块的覆盖率处理
  - _需求: 5.1, 5.2_

- [ ]\* 4.6 性能影响评估

  - 测量新脚本对测试执行时间的影响
  - 评估日志文件写入对系统性能的影响
  - 确保优化不会显著降低测试执行效率
  - _需求: 性能要求_

- [ ] 5. 完善和优化

  - 根据测试结果调整输出格式和错误处理
  - 优化日志文件结构和 AI 可读性
  - 完善文档和使用指南
  - _需求: 文档和使用性需求_

- [ ] 5.1 优化控制台输出格式

  - 根据实际使用情况调整控制台摘要格式
  - 确保关键信息清晰显示，减少噪音
  - 优化错误提示和日志文件路径显示
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [ ] 5.2 完善 AI 可读错误摘要

  - 优化错误摘要文件的结构和格式
  - 确保包含足够的上下文信息用于问题诊断
  - 添加错误分类和优先级信息
  - _需求: 3.1, 3.2, 3.3_

- [ ] 5.3 更新项目文档

  - 在项目 README 中添加新测试脚本的使用说明
  - 创建测试输出优化的详细使用指南
  - 为 AI 助手提供日志文件读取和分析说明
  - _需求: 文档需求_

- [ ] 6. 高级功能扩展 (可选)

  - 实现测试结果历史记录和趋势分析
  - 添加测试失败通知和报警机制
  - 集成 CI/CD 流程的测试报告生成
  - _需求: 扩展功能需求_

- [ ]\* 6.1 实现测试历史记录

  - 保存历史测试结果用于趋势分析
  - 实现测试结果对比和回归检测
  - 生成测试质量趋势报告
  - _需求: 扩展功能_

- [ ]\* 6.2 添加通知和报警机制

  - 实现测试失败的邮件或消息通知
  - 添加覆盖率下降的警告机制
  - 集成团队协作工具的通知功能
  - _需求: 扩展功能_
